\chapter{Semidefinitní programování}

Na semidefinitní programování se můžeme koukat jako na zobecnění lineárního programování, kde proměnné jsou symetrické matice. Jedná se tedy o optimalizaci lineární funkce vzhledem k tzv. lineárním maticovým nerovnostem.

\section{Vsuvka z lineární algebry}

\subsection*{Pozitivně definitní matice}

Pracujeme s reálnými symetrickými maticemi $S = S^T$. Ty mají všechna vlastní čísla reálná a některé z nich mají zajímavou vlastnost, že všechna jejich vlastní čísla jsou kladná. Takovým maticím říkáme, že jsou pozitivně definitní. Alternativní definicí je, že matice $S$ je pozitivně definitní, jestliže $x^TSx > 0$ pro všechny nenulové vektory $x$.

\begin{pr}
$$
    x^T S x = 
    \begin{bmatrix}
        x_1 & x_2
    \end{bmatrix}
    \begin{bmatrix}
        2 & 4 \\
        4 & 9
    \end{bmatrix}
    \begin{bmatrix}
        x_1 \\
        x_2
    \end{bmatrix} =
    2 x_1^2 + 8 x_1 x_2 + 9 x_2^2
$$
Je pro všechny $x$ nenulové $x^TSx > 0$? Ano, protože můžeme výraz přepsat na součet čtverců:
$$
    x^TSx = 2 x_1^2 + 8 x_1 x_2 + 9 x_2^2 = 2 (x_1 + 2 x_2)^2 + x_2^2.
$$
TODO: obrázek kyblíčku
\end{pr}

Ukážeme si několik kritérií, jak otestovat pozitivní definitnost dané matice.

\begin{vt}
    $S = S^T$ je pozitivně definitní, jestliže lze napsat jako $S = A^T A$ pro nějakou matici $A$, která má lineárně nezávislé sloupečky.
\end{vt}
\begin{proof}
    \begin{equation}
    \label{eq:tmp}
        x^TSx = x^TA^TAx = (Ax)^T(Ax) = \lVert Ax \rVert^2 \geq 0
    \end{equation}
    $\lVert Ax \rVert^2 > 0$, jestliže sloupečky matice $A$ jsou lineárně nezávislé
\end{proof}

\begin{pr}
    $$
        S = 
        \begin{bmatrix}
            2 & 3 & 4 \\
            3 & 5 & 7 \\
            4 & 7 & 10
        \end{bmatrix} =
        \begin{bmatrix}
            1 & 1 \\
            1 & 2 \\
            1 & 3
        \end{bmatrix}
        \begin{bmatrix}
            1 & 1 & 1 \\
            1 & 2 & 3
        \end{bmatrix} =
        AA^T
    $$
    $A$ má lineárně závislé sloupečky, tj. $S$ není pozitivně definitní
\end{pr}

Dalším testem je tzv. Sylvesterovo kritérium.

\begin{vt}
    $S = S^T$ je pozitivně definitní, jestliže všechny hlavní minory $S$ jsou kladné.
\end{vt}

\begin{pr}
    $$  S =
        \begin{bmatrix}
            3 & 4 \\
            4 & 6
        \end{bmatrix},
        D_1 = 3,
        D_2 = 3 \cdot 6 - 4 \cdot 4 = 2 
    $$
    hlavní minory $D_1, D_2 > 0$; matice $S$ je pozitivně definitní 
\end{pr}

A poslední, které si uvedeme souvisí s Gaussovou eliminací.

\begin{vt}
    $S = S^T$ je pozitivně definitní, jestliže jsou všechny pivoty při Gaussově eliminaci kladné.
\end{vt}

\begin{pr}
    $$  S =
        \begin{bmatrix}
            3 & 4 \\
            4 & 6
        \end{bmatrix}
        \sim
        \begin{bmatrix}
            3 & 4 \\
            0 & \frac{2}{3}
        \end{bmatrix},
        p_1 = 3, p_2 = \frac{2}{3} 
    $$
    pivoty $p_1, p_2 > 0$; matice $S$ je pozitivně definitní
\end{pr}

\subsection*{Pozitivně semidefinitní matice}

Pro pozitivní semidefinitnost modifikujeme předcházejí definice a tvrzení pro pozitivně definitní matice následovně:
\begin{enumerate}
    \item $S = S^T$ je pozitivně semidefinitní, jestliže všechna její čísla jsou nezáporná.
    \item $S = S^T$ je pozitivně semidefinitní, jestliže $x^TSx \geq 0$ pro všechny nenulové vektory $x$.
    \item $S = S^T$ je pozitivně semidefinitní, jestliže lze napsat jako $S = A^T A$ pro nějakou matici $A$.
    \item $S = S^T$ je pozitivně semidefinitní, jestliže všechny hlavní minory $S$ jsou nezáporné.
    \item $S = S^T$ je pozitivně semidefinitní, jestliže jsou všechny pivoty při eliminaci nezáporné.
\end{enumerate}

\subsection*{Pozitivně semidefinitní kužel}

Množinu všech symetrických matic značíme $S^n$, množinu všech pozitivně semidefinitních matic značíme $S_+^n$ a množinu všech pozitivně definitních matic značíme $S_{++}^n$.

\begin{lm}
    Množina $S_n^+$ je uzavřená
\end{lm}

\begin{proof}
    TODO
\end{proof}

\begin{lm}
    Množina $S_+^n$ tvoří konvexní kužel.
\end{lm}

\begin{proof}
    $\Theta_1, \Theta_2 \geq 0$, $A, B \in S_+^n$
    $$
        x^T \left( \Theta_1 A + \Theta_2 B \right) x = x^T \Theta_1 A x + x^T \Theta_2 B x \geq 0.
    $$
\end{proof}

\begin{lm}
    Kužel $S_+^n$ je pointed.
\end{lm}

\begin{proof}
    TODO
\end{proof}

\begin{lm}
    Kužel $S_+^n$ je samoduální.
\end{lm}

\begin{proof}
    TODO
\end{proof}

\noindent Shrneme předchozí lemmata do následující věty.

\begin{vt}
    Množina $S_+^n$ tvoří konvexní, pointed a uzavřený kužel, který je samoduální.
\end{vt}

Říkáme, že $S_+^n$ je \textbf{pozitivně semidefinitní kužel}.

\subsection*{Spektraedry}

Definujeme tzv. \textbf{L\"{o}wnerovo částečné uspořádání}:
$$
    A \succeq B \iff A - B \in S_+^n,
$$
tj. matice $A - B$ je pozitivně semidefinitní. \textbf{Lineární maticová nerovnost} (LMI) je ve tvaru
$$
    A_0 + \sum_{i=1}^n A_i x_i \succeq 0,
$$
kde $A_i \in S^n$.

Množina $S \subset \mathbb{R}^n$, která je definována pomocí konečně mnoha LMI, se nazývá \textbf{spektraedr}. Tedy:
$$
    S = \left\{ (x_1, \dots, x_m) \in \mathbb{R}^m \mid A_0 + \sum_{i=1}^m A_i x_i \succeq 0 \right\}
$$
pro nějaké symetrické matice $A_0, \dots, A_m \in S^n$.

Můžeme si všimnout analogie s definicí polyedru, který je přípustnou množinu pro lineární program. Podobně spektraedr je přípustnou množinou pro semidefinitní program.

Geometricky je spektraedr definován jako průnik pozitivně semidefinitního kuželu $S_+^n$ a afinního podprostoru $\textbf{span}\left\{ A_1, \dots, A_m \right\}$ posunutého do $A_0$.

Spektraedry jsou uzavřené množiny, neboť LMI je ekvivalentní nekonečně mnoha skalárním nerovnostem ve tvaru $v^T(A_0 + \sum_{i=1}^m A_ix_i)v \geq 0$, jednu pro každou hodnotu $v \in \mathbb{R}^n$.

Vždy můžeme několik LMI \uv{scucnout} do jedné. Stačí zvolit matice $A_i$ blokově diagonální. Odtud snadno vídíme, že polyedr je speciálním případem spektraedru. Polyedr bude mít všechny matice $A_i$ diagonální.

\begin{pr}
    $$
        \left\{ (x, y) \in \mathbb{R}^2 \mid A(x,y) =
        \begin{bmatrix}
            x + 1 & 0      & y \\
            0     & 2      & -x - 1 \\
            y     & -x - 1 & 2
        \end{bmatrix}
        \succeq 0 \right\}
    $$
\end{pr}

\section{Primární úloha}

Semidefinitní program je lineární optimalizační problém přes spektraedr. Primární úlohu ve standardním tvaru můžeme napsat jako:
\begin{equation}\tag{SDP-P}
    \inf \left\{ \langle C, X \rangle \mid \langle A_i, X \rangle = b_i, i=1, \dots, m; X \succeq 0 \right\},
    \label{eq:SDP-P}
\end{equation}
kde $C, A_i \in S^n$, $\langle X, Y \rangle = \textbf{Tr}(X^T Y) = \sum_{ij} X_{ij}Y_{ij}$ a $X \in S^n$ je proměnná, nad kterou provádíme minimalizaci.

\begin{pr}
    \begin{equation}\tag{P3}
        \inf \left\{
            \left\langle
            \begin{bmatrix}
                2 & 1 \\
                1 & 0
            \end{bmatrix},
            \begin{bmatrix}
                x_{11} & x_{12} \\
                x_{12} & x_{22}
            \end{bmatrix}
            \right\rangle \middle|
            \left\langle
            \begin{bmatrix}
                1 & 0 \\
                0 & 1
            \end{bmatrix},
            \begin{bmatrix}
                x_{11} & x_{12} \\
                x_{12} & x_{22}
            \end{bmatrix}
            \right\rangle = 1,
            \begin{bmatrix}
                x_{11} & x_{12} \\
                x_{12} & x_{22}
            \end{bmatrix} \succeq 0
        \right\}
        \label{eq:P3}
    \end{equation}
    Po úpravě:
    $$
        \inf \left\{
            2 x_{11} + 2 x_{12} \middle| x_{11} + x_{22} = 1, 
            \begin{bmatrix}
                x_{11} & x_{12} \\
                x_{12} & x_{22}
            \end{bmatrix} \succeq 0
        \right\}.
    $$
    Jak vypadá přípustná množina? Použijeme Sylvesterovo kritérium, tj.
    $$
        x_{11} \geq 0, x_{11} x_{22} - x_{12}^2 \geq 0.
    $$
    Z LMI vyjádříme $x_{22}$, tj.
    $$
        x_{22} = 1 - x_{11}
    $$
    Dosadíme do přechozího a dostaneme
    $$
        x_{11} \geq 0, x_{11} \left(1 - x_{11}\right) - x_{12}^2 \geq 0
    $$
    Po úpravě
    $$
        x_{11} \geq 0, \left(x_{11} - \frac{1}{2}\right)^2 + x_{12}^2 \leq \frac{1}{4}
    $$
    Vidíme tedy, že přípustná množina (zobrazena na obrázku~\ref{fig:ex3}) je kruh s poloměrem $\frac{1}{2}$ a se středem v bodě $(x_{11}, x_{12}) = (\frac{1}{2}, 0)$. Řešením úlohy je matice
    $$
        X^* \approx
        \begin{bmatrix}
            0.1464  & -0.3536 \\
            -0.3536 &  0.8536
        \end{bmatrix}
    $$
    s cenou $\approx -0.4142$. Implementace v softwaru MOSEK: \url{https://github.com/c0n73x7/D1PL0MK4/blob/master/mosek/ex3.py}.
\end{pr}

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.5\textwidth]{img/ex3.png}   
    \caption{Přípustná množina řešení k úloze~\ref{eq:P3}.}
    \label{fig:ex3}
\end{figure}

\section{Dualita}

\subsubsection*{Duální úloha}

Podobně jako u lineárního programování použijeme Lagrangeovu dualitu k odvození duální úlohy k úloze~\ref{eq:SDP-P}. Lagrangeova funkce je ve tvaru:
$$
    L(X, \lambda, Z) = \langle C, X \rangle - \sum_{i=1}^m \lambda_i \left( \langle A_i, X \rangle - b_i \right) - \langle Z, X \rangle.
$$

\noindent K ní duální funkce:
$$
    d(\lambda, Z) = \inf_{X \in S^n} L(X, \lambda, Z) = 
    \begin{cases}
        \lambda^T b & \dots\ C - \sum_{i=1}^m \lambda_i A_i - Z = 0, \\
        -\infty     & \dots\ \text{jinak.}
    \end{cases}
$$

\noindent Duální funkci použijeme v duální úloze:
\begin{equation}\tag{SDP-D}
    \sup\left\{ \lambda^Tb \mid C - \sum_{i=1}^m \lambda_i A_i \succeq 0 \right\},
    \label{eq:SDP-D}
\end{equation}
kde $\lambda = (\lambda_1, \dots, \lambda_m)$ je duální proměnná.

\noindent Dostali jsme duální úlohu~\ref{eq:SDP-D} k úloze~\ref{eq:SDP-P}.

\subsubsection*{Slabá dualita semidefinitního programování}

Vztah mezi primární a duální úlohou je podobně jako u lineárního programování v tom, že řešení jedné úlohy lze použít jako odhad na úlohu druhou. Nechť $X$ je libovolné přípustné řešení primární úlohy a $y$ je libovolné přípustné řešení duální úlohy. Potom
$$
    \langle C, X \rangle - b^T y =
    \langle C, X \rangle - \sum_{i=1}^m y_i \langle A_i, X \rangle =
    \left\langle C - \sum_{i=1}^m A_i y_i, X \right\rangle \geq 0
$$

\subsubsection*{Silná dualita semidefinitního programování}



\section*{WIP}

Stopa matice $A \in R^{n \times n}$ je $\textbf{Tr}(A) = \sum_{i=1}^n A_{ii}$.

\begin{vt}
$S, T$ jsou pozitivně definitní $\implies$ $S + T$ je pozitivně definitní
\end{vt}

\begin{proof}
$x^T (S+T) x = x^T S x + x^T T x > 0$
\end{proof}


\noindent Úlohy s racionálními daty nemusí mít racionální optimální řešení.
\noindent příklad

\noindent Jen 3 kužely s vlastnostmi jako PSD cone. Zmrzlina, a ještě jeden.
\noindent Vnitřek $S_+^n$ je $S_{++}^n$.


%spektraedr, formulace, dualita, semidefinitní kužel, duální kužel, ...
%vektorové programování a jeho ekvivalence, formulace úloh